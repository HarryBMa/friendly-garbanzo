import{e as W}from"./exceljs.min-C7gE75I7.js";import{g as v}from"./index-HoZP0huy.js";async function F(n){try{const r=new W.Workbook,w=await n.arrayBuffer();await r.xlsx.load(w);const a=n.name.toLowerCase().includes("ane")?"ane":"op",k=[],i=[];let l=null,c=null;for(let o=0;o<r.worksheets.length;o++){const e=r.worksheets[o];try{const t=await x(e,a,o);k.push(...t.staff),t.weekNumber&&((l===null||t.weekNumber<l)&&(l=t.weekNumber),(c===null||t.weekNumber>c)&&(c=t.weekNumber)),t.warnings.length>0&&i.push(...t.warnings.map(s=>`Sheet ${o+1}: ${s}`))}catch(t){i.push(`Sheet ${o+1}: ${t instanceof Error?t.message:"Parse error"}`)}}if(l===null||c===null){const o=n.name.match(/v\.?(\d+)-(\d+)/i);o&&(l=parseInt(o[1]),c=parseInt(o[2]))}return{startWeek:l||1,endWeek:c||1,weekSpan:`v.${l||1}-${c||1}`,totalWeeks:r.worksheets.length,staff:k,fileName:n.name,source:a,warnings:i.length>0?i:void 0}}catch(r){throw new Error(`Failed to parse ${n.name}: ${r instanceof Error?r.message:"Unknown error"}`)}}async function x(n,r,w){var s,y,$,S,N;const a=r==="ane",k=a?2:3,i=3;let l=r==="op"?"op_ssk":"ane_ssk";const c=[],o=[];let e=null;const t=[];for(let f=i;f<i+5;f++){const d=((s=n.getCell(k,f).value)==null?void 0:s.toString().trim())||"",[m,u]=d.split(" ");if(!e&&u)try{const p=2e3+parseInt(u.slice(0,2)),b=parseInt(u.slice(2,4))-1,h=parseInt(u.slice(4,6)),g=new Date(p,b,h);e=v(g)}catch{c.push(`Could not parse date: ${u}`)}t.push({col:f,name:m,date:u})}for(let f=k+1;f<n.rowCount;f++){const d=(y=n.getCell(f,2).value)==null?void 0:y.toString().trim();if(!d)continue;const m=d.toLowerCase();if(m.includes("usk")){l=a?"ane_usk":"op_usk";continue}if(!["kÃ¤k","antal","vakant"].some(u=>m.includes(u)))for(const{col:u,name:p,date:b}of t){const h=(($=n.getCell(f,u).value)==null?void 0:$.toString().trim())||"",g=((S=n.getCell(f+1,u).value)==null?void 0:S.toString().trim())||"",C=((N=n.getCell(f+2,u).value)==null?void 0:N.toString().trim())||"";!h&&!g&&!C||o.push({name:d,role:l,weekday:p,date:b,weekNumber:e||w+1,sheetIndex:w,workHours:h,comments:g||void 0,extraInfo:C||void 0,sourceFile:r})}}return{staff:o,weekNumber:e,warnings:c}}function _(n,r,w=[]){const a=[...w],k=[],i=[];let l=0,c=0,o="";if(n){l=n.staff.length,o=n.weekSpan;for(const e of n.staff){const t=a.findIndex(s=>s.name===e.name&&s.weekday===e.weekday&&s.weekNumber===e.weekNumber);if(t>=0){const s=a[t];s.sourceFile!==e.sourceFile&&k.push(`Updated ${e.name} (Week ${e.weekNumber}, ${e.weekday})`),a[t]={...s,...e}}else a.push(e),i.push(`Added OP: ${e.name} (Week ${e.weekNumber}, ${e.weekday})`)}}if(r){c=r.staff.length,o=o||r.weekSpan;for(const e of r.staff){const t=a.findIndex(s=>s.name===e.name&&s.weekday===e.weekday&&s.weekNumber===e.weekNumber);if(t>=0){const s=a[t];s.sourceFile!==e.sourceFile&&k.push(`Updated ${e.name} (Week ${e.weekNumber}, ${e.weekday})`),a[t]={...s,...e}}else a.push(e),i.push(`Added ANE: ${e.name} (Week ${e.weekNumber}, ${e.weekday})`)}}return{success:!0,opData:n,aneData:r,combinedStaff:a,mergeReport:{opStaffCount:l,aneStaffCount:c,totalStaffCount:a.length,weekSpan:o,conflicts:k.length>0?k:void 0,additions:i.length>0?i:void 0}}}export{_ as combineMultiWeekData,F as parseMultiWeekExcelFile};
