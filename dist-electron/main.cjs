"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("electron"),E=require("url"),i=require("path"),w=require("exceljs");var p=typeof document<"u"?document.currentScript:null;async function g(l){try{let n=l;if(!n){const e=await s.dialog.showOpenDialog({title:"Importera personal från Excel",filters:[{name:"Excel-filer",extensions:["xlsx","xls"]},{name:"Alla filer",extensions:["*"]}],properties:["openFile"]});if(e.canceled||!e.filePaths.length)return{success:!1,data:[],errors:["Import avbruten"]};n=e.filePaths[0]}const c=new w.Workbook;await c.xlsx.readFile(n);const o=c.getWorksheet(1);if(!o)return{success:!1,data:[],errors:["Kunde inte läsa arbetsblad"]};const r=[],a=[];return o.eachRow((e,u)=>{if(u===1)return;const f=e.getCell(1).text?.trim(),h=e.getCell(2).text?.trim(),x=e.getCell(3).text?.trim()||"";if(!f){a.push(`Rad ${u}: Namn saknas`);return}if(!h){a.push(`Rad ${u}: Arbetstid saknas för ${f}`);return}r.push({name:f,workHours:h,comments:x})}),{success:!0,data:r,errors:a.length>0?a:void 0}}catch(n){return{success:!1,data:[],errors:[`Import misslyckades: ${n instanceof Error?n.message:"Okänt fel"}`]}}}async function _(l){try{const n=await s.dialog.showSaveDialog({title:"Exportera schema till Excel",defaultPath:`schema_${new Date().toISOString().slice(0,10)}.xlsx`,filters:[{name:"Excel-filer",extensions:["xlsx"]},{name:"Alla filer",extensions:["*"]}]});if(n.canceled||!n.filePath)return{success:!1,error:"Export avbruten"};const c=new w.Workbook,o=c.addWorksheet("Schema");return o.addRow(["Dag","Sal","Roll","Personal","Arbetstid","Kommentarer"]),l&&l.days&&l.days.forEach(r=>{const a=r.name||r.id;r.operatingRooms&&r.operatingRooms.forEach(e=>{e.pass&&o.addRow([a,e.name,"Pass",e.pass.name,e.pass.workHours,e.pass.comments||""]),e.opSSK&&o.addRow([a,e.name,"Op SSK",e.opSSK.name,e.opSSK.workHours,e.opSSK.comments||""]),e.aneSSK&&o.addRow([a,e.name,"Ane SSK",e.aneSSK.name,e.aneSSK.workHours,e.aneSSK.comments||""])}),r.corridorStaff&&r.corridorStaff.forEach(e=>{o.addRow([a,"Korridor",e.role,e.name,e.workHours,e.comments||""])})}),await c.xlsx.writeFile(n.filePath),{success:!0,filePath:n.filePath}}catch(n){return{success:!1,error:`Export misslyckades: ${n instanceof Error?n.message:"Okänt fel"}`}}}const m=i.dirname(E.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:p&&p.tagName.toUpperCase()==="SCRIPT"&&p.src||new URL("main.cjs",document.baseURI).href));process.env.APP_ROOT=i.join(m,"../..");const P=i.join(process.env.APP_ROOT,"dist-electron"),S=i.join(process.env.APP_ROOT,"dist"),d=process.env.VITE_DEV_SERVER_URL;process.env.VITE_PUBLIC=d?i.join(process.env.APP_ROOT,"public"):S;let t=null;function R(){t=new s.BrowserWindow({width:1920,height:1080,icon:i.join(process.env.VITE_PUBLIC||m,"icon.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:i.join(m,"preload.cjs")},fullscreen:!1,resizable:!0,minimizable:!0,maximizable:!0}),t.webContents.on("did-finish-load",()=>{t?.webContents.send("main-process-message",new Date().toLocaleString())}),d?(t.loadURL(d),t.webContents.openDevTools()):t.loadFile(i.join(S,"index.html"))}s.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(s.app.quit(),t=null)});s.app.on("activate",()=>{s.BrowserWindow.getAllWindows().length===0&&R()});s.app.whenReady().then(R);s.ipcMain.handle("import-excel",async(l,n)=>await g(n));s.ipcMain.handle("export-excel",async(l,n)=>await _(n));s.ipcMain.handle("toggle-fullscreen",async()=>t?(t.setFullScreen(!t.isFullScreen()),t.isFullScreen()):!1);exports.MAIN_DIST=P;exports.RENDERER_DIST=S;exports.VITE_DEV_SERVER_URL=d;
