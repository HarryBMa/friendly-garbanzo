"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("electron"),x=require("url"),r=require("path"),w=require("exceljs");var S=typeof document<"u"?document.currentScript:null;async function g(l){try{let n=l;if(!n){const e=await s.dialog.showOpenDialog({title:"Importera personal från Excel",filters:[{name:"Excel-filer",extensions:["xlsx","xls"]},{name:"Alla filer",extensions:["*"]}],properties:["openFile"]});if(e.canceled||!e.filePaths.length)return{success:!1,data:[],errors:["Import avbruten"]};n=e.filePaths[0]}const c=new w.Workbook;await c.xlsx.readFile(n);const i=c.getWorksheet(1);if(!i)return{success:!1,data:[],errors:["Kunde inte läsa arbetsblad"]};const o=[],a=[];return i.eachRow((e,p)=>{if(p===1)return;const m=e.getCell(1).text?.trim(),h=e.getCell(2).text?.trim(),E=e.getCell(3).text?.trim()||"";if(!m){a.push(`Rad ${p}: Namn saknas`);return}if(!h){a.push(`Rad ${p}: Arbetstid saknas för ${m}`);return}o.push({name:m,workHours:h,comments:E})}),{success:!0,data:o,errors:a.length>0?a:void 0}}catch(n){return{success:!1,data:[],errors:[`Import misslyckades: ${n instanceof Error?n.message:"Okänt fel"}`]}}}async function _(l){try{const n=await s.dialog.showSaveDialog({title:"Exportera schema till Excel",defaultPath:`schema_${new Date().toISOString().slice(0,10)}.xlsx`,filters:[{name:"Excel-filer",extensions:["xlsx"]},{name:"Alla filer",extensions:["*"]}]});if(n.canceled||!n.filePath)return{success:!1,error:"Export avbruten"};const c=new w.Workbook,i=c.addWorksheet("Schema");return i.addRow(["Dag","Sal","Roll","Personal","Arbetstid","Kommentarer"]),l&&l.days&&l.days.forEach(o=>{const a=o.name||o.id;o.operatingRooms&&o.operatingRooms.forEach(e=>{e.pass&&i.addRow([a,e.name,"Pass",e.pass.name,e.pass.workHours,e.pass.comments||""]),e.opSSK&&i.addRow([a,e.name,"Op SSK",e.opSSK.name,e.opSSK.workHours,e.opSSK.comments||""]),e.aneSSK&&i.addRow([a,e.name,"Ane SSK",e.aneSSK.name,e.aneSSK.workHours,e.aneSSK.comments||""])}),o.corridorStaff&&o.corridorStaff.forEach(e=>{i.addRow([a,"Korridor",e.role,e.name,e.workHours,e.comments||""])})}),await c.xlsx.writeFile(n.filePath),{success:!0,filePath:n.filePath}}catch(n){return{success:!1,error:`Export misslyckades: ${n instanceof Error?n.message:"Okänt fel"}`}}}const d=r.dirname(x.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:S&&S.tagName.toUpperCase()==="SCRIPT"&&S.src||new URL("main.cjs",document.baseURI).href));console.log("__dirname:",d);console.log("APP_ROOT will be:",r.join(d,"../.."));process.env.APP_ROOT=r.join(d,"../..");const P=r.join(process.env.APP_ROOT,"dist-electron"),u=r.join(process.env.APP_ROOT,"dist"),f=process.env.VITE_DEV_SERVER_URL;console.log("RENDERER_DIST:",u);console.log("Looking for index.html at:",r.join(u,"index.html"));process.env.VITE_PUBLIC=f?r.join(process.env.APP_ROOT,"public"):u;let t=null;function R(){t=new s.BrowserWindow({width:1920,height:1080,icon:r.join(process.env.VITE_PUBLIC||d,"icon.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:r.join(d,"preload.cjs")},fullscreen:!1,resizable:!0,minimizable:!0,maximizable:!0}),t.webContents.on("did-finish-load",()=>{t?.webContents.send("main-process-message",new Date().toLocaleString())}),f?(t.loadURL(f),t.webContents.openDevTools()):t.loadFile(r.join(u,"index.html"))}s.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(s.app.quit(),t=null)});s.app.on("activate",()=>{s.BrowserWindow.getAllWindows().length===0&&R()});s.app.whenReady().then(R);s.ipcMain.handle("import-excel",async(l,n)=>await g(n));s.ipcMain.handle("export-excel",async(l,n)=>await _(n));s.ipcMain.handle("toggle-fullscreen",async()=>t?(t.setFullScreen(!t.isFullScreen()),t.isFullScreen()):!1);exports.MAIN_DIST=P;exports.RENDERER_DIST=u;exports.VITE_DEV_SERVER_URL=f;
