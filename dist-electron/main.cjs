"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("electron"),R=require("url"),d=require("path"),E=require("exceljs");var w=typeof document<"u"?document.currentScript:null;async function N(r){try{let e=r;if(!e){const i=await l.dialog.showOpenDialog({title:"Importera personal från Excel",filters:[{name:"Excel-filer",extensions:["xlsx","xls"]},{name:"Alla filer",extensions:["*"]}],properties:["openFile"]});if(i.canceled||!i.filePaths.length)return{success:!1,data:[],errors:["Import avbruten"]};e=i.filePaths[0]}const a=new E.Workbook;await a.xlsx.readFile(e);const o=a.getWorksheet(1);if(!o)return{success:!1,data:[],errors:["Kunde inte läsa arbetsblad"]};const n=[],s=[];return o.eachRow((i,c)=>{if(c===1)return;const m=i.getCell(1).text?.trim(),f=i.getCell(2).text?.trim(),t=i.getCell(3).text?.trim()||"";if(!m){s.push(`Rad ${c}: Namn saknas`);return}if(!f){s.push(`Rad ${c}: Arbetstid saknas för ${m}`);return}n.push({name:m,workHours:f,comments:t})}),{success:!0,data:n,errors:s.length>0?s:void 0}}catch(e){return{success:!1,data:[],errors:[`Import misslyckades: ${e instanceof Error?e.message:"Okänt fel"}`]}}}async function F(){try{const r=await l.dialog.showOpenDialog({title:"Importera OP- och ANE-filer (.xlsx)",filters:[{name:"Excel-filer",extensions:["xlsx","xls"]},{name:"Alla filer",extensions:["*"]}],properties:["openFile","multiSelections"]});if(r.canceled||!r.filePaths.length)return{success:!1,week:"",opFileName:"",aneFileName:"",data:[],errors:["Import avbruten"]};if(r.filePaths.length!==2)return{success:!1,week:"",opFileName:"",aneFileName:"",data:[],errors:["Ladda upp exakt 2 filer: en OP-fil och en ANE-fil"]};const e=r.filePaths.map(t=>({path:t,name:t.split("\\").pop()||t.split("/").pop()||"",type:y(t)})),a=e.find(t=>t.type==="OP"),o=e.find(t=>t.type==="ANE");if(!a||!o)return{success:!1,week:"",opFileName:"",aneFileName:"",data:[],errors:['Kunde inte identifiera OP- och ANE-filer. Kontrollera att filnamnen innehåller "OP" respektive "ANE"']};const[n,s]=await Promise.all([g(a.path),g(o.path)]);if(!n.success||!s.success)return{success:!1,week:"",opFileName:a.name,aneFileName:o.name,data:[],errors:[...(n.errors||[]).map(t=>`OP-fil: ${t}`),...(s.errors||[]).map(t=>`ANE-fil: ${t}`)]};const i=[],c=[];i.push(...n.data.map(t=>({...t,comments:t.comments?`[OP] ${t.comments}`:"[OP]"}))),i.push(...s.data.map(t=>({...t,comments:t.comments?`[ANE] ${t.comments}`:"[ANE]"})));const m=new Map;return i.forEach(t=>{const p=t.name.toLowerCase();m.set(p,(m.get(p)||0)+1)}),m.forEach((t,p)=>{t>1&&c.push(`Dublett hittad: "${p}" finns i både OP- och ANE-filen`)}),{success:!0,week:S(a.name)||S(o.name),opFileName:a.name,aneFileName:o.name,data:i,warnings:c.length>0?c:void 0}}catch(r){return{success:!1,week:"",opFileName:"",aneFileName:"",data:[],errors:[`Import misslyckades: ${r instanceof Error?r.message:"Okänt fel"}`]}}}async function g(r){try{const e=new E.Workbook;await e.xlsx.readFile(r);const a=e.getWorksheet(1);if(!a)return{success:!1,data:[],errors:["Kunde inte läsa arbetsblad"]};const o=[],n=[];return a.eachRow((s,i)=>{if(i===1)return;const c=s.getCell(1).text?.trim(),m=s.getCell(2).text?.trim(),f=s.getCell(3).text?.trim()||"";if(!c){n.push(`Rad ${i}: Namn saknas`);return}if(!m){n.push(`Rad ${i}: Arbetstid saknas för ${c}`);return}o.push({name:c,workHours:m,comments:f})}),{success:!0,data:o,errors:n.length>0?n:void 0}}catch(e){return{success:!1,data:[],errors:[`Läsfel: ${e instanceof Error?e.message:"Okänt fel"}`]}}}function y(r){const e=r.toLowerCase();return e.includes("op")&&!e.includes("ane")?"OP":e.includes("ane")||e.includes("anestesi")?"ANE":"UNKNOWN"}function S(r){const e=r.toLowerCase().match(/(?:vecka|v|week)\.?(\d{1,2})/);if(e)return`v.${e[1]}`;const a=new Date;return`v.${Math.ceil((a.getTime()-new Date(a.getFullYear(),0,1).getTime())/(7*24*60*60*1e3))}`}async function b(r){try{const e=await l.dialog.showSaveDialog({title:"Exportera schema till Excel",defaultPath:"schema.xlsx",filters:[{name:"Excel-filer",extensions:["xlsx"]},{name:"Alla filer",extensions:["*"]}]});if(e.canceled||!e.filePath)return{success:!1,error:"Export avbruten"};const a=new E.Workbook,o=a.addWorksheet("Schema");return o.columns=[{header:"Dag",key:"day",width:15},{header:"Sal",key:"room",width:20},{header:"Pass",key:"pass",width:20},{header:"OP SSK",key:"opSSK",width:20},{header:"ANE SSK",key:"aneSSK",width:20},{header:"Korridor",key:"corridor",width:25}],r?.days&&r.days.forEach(n=>{n.operatingRooms&&n.operatingRooms.forEach(s=>{o.addRow({day:n.name||n.id,room:s.name,pass:s.pass?.name||"",opSSK:s.opSSK?.name||"",aneSSK:s.aneSSK?.name||""})}),n.corridorStaff&&n.corridorStaff.forEach(s=>{o.addRow({day:n.name||n.id,room:"",pass:"",opSSK:"",aneSSK:"",corridor:`${s.role}: ${s.staff?.name||""}`})})}),await a.xlsx.writeFile(e.filePath),{success:!0,filePath:e.filePath}}catch(e){return{success:!1,error:`Export misslyckades: ${e instanceof Error?e.message:"Okänt fel"}`}}}const x=d.dirname(R.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:w&&w.tagName.toUpperCase()==="SCRIPT"&&w.src||new URL("main.cjs",document.baseURI).href));process.env.APP_ROOT=d.join(x,"..");const O=d.join(process.env.APP_ROOT,"dist-electron"),k=d.join(process.env.APP_ROOT,"dist"),h=process.env.VITE_DEV_SERVER_URL;process.env.VITE_PUBLIC=h?d.join(process.env.APP_ROOT,"public"):k;let u=null;function P(){u=new l.BrowserWindow({width:1920,height:1080,icon:d.join(process.env.VITE_PUBLIC||x,"icon.png"),webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:d.join(x,"preload.cjs")},fullscreen:!1,resizable:!0,minimizable:!0,maximizable:!0}),u.webContents.on("did-finish-load",()=>{u?.webContents.send("main-process-message",new Date().toLocaleString())}),h?(u.loadURL(h),u.webContents.openDevTools()):u.loadFile(d.join(k,"index.html"))}l.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(l.app.quit(),u=null)});l.app.on("activate",()=>{l.BrowserWindow.getAllWindows().length===0&&P()});l.app.whenReady().then(P);l.ipcMain.handle("import-excel",async(r,e)=>await N(e));l.ipcMain.handle("import-dual-excel",async()=>await F());l.ipcMain.handle("export-excel",async(r,e)=>await b(e));l.ipcMain.handle("toggle-fullscreen",async()=>u?(u.setFullScreen(!u.isFullScreen()),u.isFullScreen()):!1);exports.MAIN_DIST=O;exports.RENDERER_DIST=k;exports.VITE_DEV_SERVER_URL=h;
